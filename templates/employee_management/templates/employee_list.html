{% extends 'base.html' %}
{% load static %}

{% block title-icon %}fas fa-users{% endblock title-icon %}
{% block title %}Employee List{% endblock title %}
{% block subtitle %}View and manage all employees{% endblock subtitle %}

{% block breadcrumb-left %}
<div class="breadcrumb-container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-chevron">
      <li class="breadcrumb-item">
        <a href="{% url 'home' %}" class="text-decoration-none fw-bold">
          <i class="fas fa-home"></i> Home
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="fas fa-users"></i> Employees
      </li>
    </ol>
  </nav>
</div>
{% endblock breadcrumb-left %}

{% block page-actions %}
<div class="d-flex gap-2">
  <a class="btn btn-primary rounded-3 shadow-sm" href="{% url 'employee-create' %}">
    <i class="fas fa-plus me-2"></i> Add New Employee
  </a>
  <button type="button" class="btn btn-outline-secondary rounded-3 shadow-sm" id="refreshEmployeeList">
    <i class="fas fa-sync-alt me-2"></i> Refresh
  </button>
  <div class="dropdown">
    <button class="btn btn-outline-success rounded-3 shadow-sm dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="fas fa-download me-2"></i> Export
    </button>
    <ul class="dropdown-menu" aria-labelledby="exportDropdown">
      <li><a class="dropdown-item" href="#" id="exportCSV"><i class="fas fa-file-csv me-2"></i> Export as CSV</a></li>
      <li><a class="dropdown-item" href="#" id="exportPDF"><i class="fas fa-file-pdf me-2"></i> Export as PDF</a></li>
      <li><a class="dropdown-item" href="#" id="exportExcel"><i class="fas fa-file-excel me-2"></i> Export as Excel</a></li>
    </ul>
  </div>
</div>
{% endblock page-actions %}

{% block content %}
<div class="row mb-3">
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="fas fa-list me-2"></i> Employee List
            <span class="badge bg-primary ms-2" id="totalEmployeeCount">{{ employees|length }}</span>
          </h5>
          <div class="d-flex align-items-center">
            <div class="input-group input-group-sm me-2" style="width: 200px;">
              <span class="input-group-text" id="basic-addon1"><i class="fas fa-search"></i></span>
              <input type="text" class="form-control" id="employeeSearchInput" placeholder="Search employee..." aria-label="Search">
            </div>
          </div>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table id="employeetable" class="table table-hover table-striped mb-0">
            <thead class="table-light">
              <tr>
                <th width="5%" class="text-center">#</th>
                <th width="25%">Full Name</th>
                <th width="25%">Username</th>
                <th width="25%">Email</th>
                <th width="20%" class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for employee in employees %}
                <tr>
                  <td class="text-center">{{ forloop.counter }}</td>
                  <td>{{ employee.get_full_name|default:employee.username }}</td>
                  <td>{{ employee.username }}</td>
                  <td>{{ employee.email }}</td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm">
                      <a href="{% url 'employee-detail' employee.id %}" class="btn btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                        <i class="fas fa-eye"></i>
                      </a>
                      <a href="{% url 'employee-update' employee.id %}" class="btn btn-outline-warning" data-bs-toggle="tooltip" title="Edit">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a href="{% url 'employee-delete' employee.id %}" class="btn btn-outline-danger" data-bs-toggle="tooltip" title="Delete">
                        <i class="fas fa-trash"></i>
                      </a>
                    </div>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" class="text-center py-4">
                    <div class="empty-state">
                      <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                      <h5>No Employee Records Found</h5>
                      <p class="text-muted">Start by adding your first employee using the 'Add New Employee' button.</p>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <small class="text-muted">Showing <span id="visibleEmployeeCount">{{ employees|length }}</span> of {{ employees|length }} employees</small>
          </div>
          <div>
            <button type="button" class="btn btn-sm btn-outline-primary" id="viewAllEmployee">
              <i class="fas fa-eye me-1"></i> View All
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block morejs %}
<script>
  $(document).ready(function() {
    var employeeTable = $('#employeetable').DataTable({
      "paging": true,
      "lengthChange": true,
      "searching": true,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
      "pageLength": 10,
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "language": {
        "emptyTable": "No employee records found",
        "zeroRecords": "No matching records found",
        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
        "infoEmpty": "Showing 0 to 0 of 0 entries",
        "infoFiltered": "(filtered from _MAX_ total entries)",
        "search": "Search:",
        "paginate": {
          "first": "First",
          "last": "Last",
          "next": "Next",
          "previous": "Previous"
        }
      },
      "dom": '<"top"fl>rt<"bottom"ip><"clear">',
      "select": false,
      "columnDefs": [
        { "orderable": false, "targets": 4 }
      ]
    });

    $('#employeeSearchInput').on('keyup', function() {
      employeeTable.search(this.value).draw();
      updateVisibleCount();
    });

    $('#viewAllEmployee').on('click', function() {
      employeeTable.search('').columns().search('').draw();
      $('#employeeSearchInput').val('');
      updateVisibleCount();
    });

    $('#refreshEmployeeList').on('click', function() {
      location.reload();
    });

    $('#exportCSV').on('click', function(e) {
      e.preventDefault();
      alert('CSV Export functionality will be implemented here');
    });
    $('#exportPDF').on('click', function(e) {
      e.preventDefault();
      alert('PDF Export functionality will be implemented here');
    });
    $('#exportExcel').on('click', function(e) {
      e.preventDefault();
      alert('Excel Export functionality will be implemented here');
    });

    function updateVisibleCount() {
      var visibleRows = employeeTable.rows({search:'applied'}).count();
      $('#visibleEmployeeCount').text(visibleRows);
    }

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    $('#employeetable tbody tr').each(function(index) {
      $(this).css('opacity', '0');
      setTimeout(() => {
        $(this).animate({opacity: 1}, 200);
      }, 50 * index);
    });
  });
</script>
{% endblock morejs %}
